name: Auto Create Pull Request

on:
  push:
    branches:
      - Escopalao_Group
      - Lara_Group
      - Macas_Group
      - Manipon_Group
      - Millan_Group
      - Ru√±a_Group

jobs:
  create_pull_request:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Pull Request
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          pr_exists=$(gh pr list --base main --head ${{ github.ref_name }} --json number --jq length)
          if [ "$pr_exists" -eq "0" ]; then
            pr_url=$(gh pr create --base main --head ${{ github.ref_name }} \
              --title "Auto PR: Merge ${{ github.ref_name }} into main" \
              --body "This is an automated pull request created from a push to the ${{ github.ref_name }} branch. Please review the changes and merge if appropriate." \
              --label "automated pr" --label "review required")
            echo "Pull Request created: $pr_url"
          else
            echo "Pull request already exists for this branch"
          fi

      - name: Check if PR was created
        if: failure()
        run: echo "Failed to create pull request. Please check the logs for more information."
